#!/bin/bash
#SBATCH --job-name=SRA_accession
#SBATCH --time=0-24:00:00 # Wall clock time limit in Days-Hours:min:seconds
#SBATCH --output=SRA-%A_%a.out # output file
#SBATCH --error=SRA-%A_%a.err # error file
#SBATCH --ntasks=1 # Run 1 job
#SBATCH --ntasks-per-node=1 
#SBATCH --cpus-per-task=8 
#SBATCH --mem=100GB

#define SRA accesion ID
config_file=/hb/groups/kelley_training/owen/zoarcoidei/data/sra_id
id=$(sed -n "${SLURM_ARRAY_TASK_ID}p" "$config_file")

#load required modules
module load sratoolkit

#make required directory and move to it
mkdir -p /hb/scratch/omoosman/sra
cd /hb/scratch/omoosman/sra

#prefetch accession into scratch
prefetch "$id" --max-size 100g  -O /hb/scratch/omoosman/sra 

#convert to fastq from scratch directory 
fasterq-dump "$id"   

#compress and copy files to correct directory
gzip /hb/scratch/omoosman/sra/$id/*.fastq 
cp /hb/scratch/omoosman/sra/$id/*.fastq.gz /hb/home/omoosman/owen/zoarcoidei/data/raw_hifi/

